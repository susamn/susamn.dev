---
import { type CollectionEntry, getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
	const posts = await getCollection('blog');
	return posts.map((post) => ({
		params: { slug: post.slug },
		props: post,
	}));
}
type Props = CollectionEntry<'blog'>;

const post = Astro.props;
const { Content } = await post.render();

// Get related posts (same tags or recent)
const allPosts = await getCollection('blog');
const relatedPosts = allPosts
	.filter(p => p.slug !== post.slug)
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
	.slice(0, 3);
---

<Layout title={`${post.data.title} | Supratim Samanta`} description={post.data.description}>
	<article class="max-w-none">
		<!-- Article Header -->
		<header class="mb-10">
			<a href="/blog" class="inline-flex items-center gap-2 text-sm font-medium text-stone-400 hover:text-amber-600 transition-colors mb-6">
				<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
				</svg>
				Back to Writing
			</a>
			<div class="flex items-center gap-4 mb-4">
				<time class="text-sm font-medium text-amber-600" datetime={post.data.pubDate.toISOString()}>
					{post.data.pubDate.toLocaleDateString('en-US', {
						day: 'numeric',
						month: 'long',
						year: 'numeric',
					})}
				</time>
				<div class="flex-1 h-px bg-stone-200"></div>
			</div>
			<h1 class="font-['Fraunces',_serif] text-3xl md:text-4xl font-semibold text-stone-900 leading-tight mb-4">
				{post.data.title}
			</h1>
			<p class="text-lg text-stone-500 leading-relaxed">
				{post.data.description}
			</p>
		</header>

		<!-- Article Content -->
		<div class="bg-white rounded-xl border border-stone-200 p-6 md:p-10">
			<div class="prose prose-stone prose-lg max-w-none
				prose-headings:font-['Fraunces',_serif] prose-headings:font-semibold prose-headings:text-stone-900
				prose-h2:text-2xl prose-h2:mt-10 prose-h2:mb-4 prose-h2:pb-2 prose-h2:border-b prose-h2:border-stone-100
				prose-h3:text-xl prose-h3:mt-8 prose-h3:mb-3
				prose-h4:text-lg prose-h4:mt-6 prose-h4:mb-2
				prose-p:text-stone-600 prose-p:leading-relaxed prose-p:mb-5
				prose-a:text-amber-600 prose-a:no-underline hover:prose-a:text-amber-700 prose-a:font-medium
				prose-strong:text-stone-800 prose-strong:font-semibold
				prose-code:text-amber-700 prose-code:bg-amber-50 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:font-normal prose-code:before:content-[''] prose-code:after:content-['']
				prose-pre:bg-stone-900 prose-pre:rounded-xl prose-pre:my-6 prose-pre:shadow-lg
				prose-pre:prose-code:bg-transparent prose-pre:prose-code:text-stone-200 prose-pre:prose-code:p-0
				prose-blockquote:border-l-amber-400 prose-blockquote:bg-amber-50/50 prose-blockquote:rounded-r-lg prose-blockquote:py-1 prose-blockquote:not-italic
				prose-ul:my-4 prose-ol:my-4
				prose-li:text-stone-600 prose-li:my-1
				prose-img:rounded-xl prose-img:shadow-md prose-img:my-8
				prose-hr:border-stone-200 prose-hr:my-10">
				<Content />
			</div>
		</div>

		<!-- Article Footer -->
		<footer class="mt-10 pt-8 border-t border-stone-200">
			<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
				<div class="flex items-center gap-4">
					<img
						src="/profile.jpg"
						alt="Supratim Samanta"
						class="w-12 h-12 rounded-full object-cover border-2 border-white shadow-md"
					/>
					<div>
						<div class="font-semibold text-stone-900">Supratim Samanta</div>
						<div class="text-sm text-stone-500">Senior Software Engineer</div>
					</div>
				</div>
				<div class="flex items-center gap-4">
					<a href="https://x.com/supratimsamanta" class="text-stone-400 hover:text-stone-700 transition-colors">
						<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
					</a>
					<a href="https://github.com/susamn" class="text-stone-400 hover:text-stone-700 transition-colors">
						<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.11.81 2.235 0 1.62-.015 2.925-.015 3.315 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
					</a>
				</div>
			</div>
		</footer>
	</article>

	<!-- Related Posts -->
	{relatedPosts.length > 0 && (
		<section class="mt-16">
			<div class="flex items-center gap-4 mb-6">
				<h2 class="font-['Fraunces',_serif] text-lg font-semibold text-stone-800">More Articles</h2>
				<div class="flex-1 h-px bg-stone-200"></div>
				<a href="/blog" class="text-xs font-medium text-amber-700 hover:text-amber-800 transition-colors uppercase tracking-wide">View all</a>
			</div>
			<div class="grid md:grid-cols-3 gap-4">
				{relatedPosts.map((relPost) => (
					<a
						href={`/blog/${relPost.slug}`}
						class="group bg-white rounded-xl border border-stone-200 p-5 hover:border-amber-300 hover:shadow-md transition-all duration-200"
					>
						<time class="text-xs font-medium text-stone-400 mb-2 block">
							{relPost.data.pubDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
						</time>
						<h3 class="font-semibold text-stone-900 group-hover:text-amber-700 transition-colors leading-snug line-clamp-2">
							{relPost.data.title}
						</h3>
					</a>
				))}
			</div>
		</section>
	)}
</Layout>
