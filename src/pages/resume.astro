---
import Layout from '../layouts/Layout.astro';
import resumeData from '../data/resume.json';

const { personal_info, certifications, opensource_projects, work_experience, education, employment_history } = resumeData;

// Define after which job index (0-based) to insert a page break
// Adjust these numbers to control page layout
const pageBreaksAfterJob = [1, 3]; // Page break after T. Rowe (2nd) and Fannie Mae (4th)
---

<Layout title="Resume | Supratim Samanta">
	<!-- Hidden data for DOCX generation -->
	<script type="application/json" id="resume-data" set:html={JSON.stringify(resumeData)}></script>

	<!-- Page Header -->
	<header class="mb-6 print:hidden">
		<div class="flex items-center gap-4 mb-4">
			<h1 class="font-['Fraunces',_serif] text-3xl font-semibold text-stone-900">Resume</h1>
			<div class="flex-1 h-px bg-stone-200"></div>
			<div class="flex gap-2">
				<button
					onclick="window.print()"
					class="inline-flex items-center gap-2 px-4 py-2 bg-amber-600 hover:bg-amber-700 text-white text-sm font-medium rounded-lg transition-colors"
				>
					<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
					</svg>
					Download PDF
				</button>
				<button
					id="download-docx"
					class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors"
				>
					<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
					</svg>
					Download DOCX
				</button>
			</div>
		</div>

		<!-- Tabs -->
		<div class="flex gap-1 border-b border-stone-200">
			<button
				class="tab-btn px-4 py-2 text-sm font-medium text-amber-700 border-b-2 border-amber-600 bg-amber-50 rounded-t-lg"
				data-tab="elaborate"
			>
				Elaborate
			</button>
			<button
				class="tab-btn px-4 py-2 text-sm font-medium text-stone-500 hover:text-stone-700 border-b-2 border-transparent hover:border-stone-300 rounded-t-lg"
				data-tab="compact"
			>
				Compact
			</button>
		</div>

		<div class="mt-3 p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800">
			<strong>Tip:</strong> In print dialog, expand "More settings" and uncheck "Headers and footers" for a clean export.
		</div>
	</header>

	<!-- Elaborate Resume (Tab 1) -->
	<div class="tab-content bg-white rounded-xl border border-stone-200 p-6 md:p-10 print:border-0 print:shadow-none print:p-0" id="elaborate" data-tab-content="elaborate">

		<!-- Header / Personal Info -->
		<header class="text-center border-b border-stone-200 pb-3 mb-3 print:pb-2 print:mb-2">
			<h1 class="text-2xl md:text-3xl font-bold text-stone-900 tracking-wide mb-1 print:text-2xl print:mb-1">{personal_info.name}</h1>
			<div class="flex flex-wrap justify-center items-center gap-x-3 gap-y-1 text-sm text-stone-600 print:text-sm print:gap-x-2">
				<span>{personal_info.location}</span>
				<span class="text-stone-300">|</span>
				<span>{personal_info.phone}</span>
				<span class="text-stone-300">|</span>
				<a href={`mailto:${personal_info.email}`} class="text-amber-600 hover:text-amber-700">{personal_info.email}</a>
				<span class="text-stone-300">|</span>
				<a href={personal_info.links.linktree} class="text-amber-600 hover:text-amber-700">{personal_info.links.linktree.replace('https://', '')}</a>
			</div>
		</header>

		<!-- Certifications -->
		<section class="mb-3 print:mb-2">
			<div class="flex items-baseline gap-3">
				<h2 class="text-xs font-bold text-stone-900 uppercase tracking-wider shrink-0">Certifications</h2>
				<div class="flex flex-wrap gap-1.5">
					{certifications.map((cert) => (
						<span class="text-xs bg-stone-100 text-stone-700 px-2 py-0.5 rounded border border-stone-200">{cert}</span>
					))}
				</div>
			</div>
		</section>

		<!-- Open Source -->
		<section class="mb-5 print:mb-4">
			<div class="flex items-baseline gap-3">
				<h2 class="text-xs font-bold text-stone-900 uppercase tracking-wider shrink-0">Open Source</h2>
				<div class="flex flex-wrap gap-1.5">
					{opensource_projects.map((project) => (
						<span class="text-xs bg-amber-50 text-amber-700 px-2 py-0.5 rounded border border-amber-200">{project}</span>
					))}
				</div>
			</div>
		</section>

		<!-- Work Experience -->
		<section class="mb-6 print:mb-4 mt-2">
			<h2 class="text-sm font-bold text-stone-900 uppercase tracking-wider border-b border-stone-300 pb-1 mb-4 print:mb-3">Professional Experience</h2>
			<div class="space-y-5 print:space-y-4">
				{work_experience.map((job, index) => (
					<>
					{pageBreaksAfterJob.includes(index - 1) && <div class="page-break"></div>}
					<div class="job-entry">
						<div class="flex flex-wrap justify-between items-start gap-2 mb-1">
							<div>
								<h3 class="font-semibold text-stone-900 print:text-sm">{job.position}</h3>
								<p class="text-sm text-amber-700 font-medium print:text-xs">{job.company} — {job.location}</p>
							</div>
							<span class="text-sm text-stone-500 font-medium shrink-0 print:text-xs">{job.duration}</span>
						</div>
						<ul class="responsibilities list-disc list-outside ml-5 space-y-0.5 text-sm text-stone-600 mb-1 print:text-xs print:space-y-0">
							{job.responsibilities.map((resp) => (
								<li class="print:leading-tight">{resp}</li>
							))}
						</ul>
						{job.challenges_and_achievements && job.challenges_and_achievements.length > 0 && (
							<div class="mt-1">
								<p class="text-xs font-semibold text-emerald-700 uppercase tracking-wide mb-0.5 print:text-[10px]">Key Achievements:</p>
								<ul class="list-disc list-outside ml-5 space-y-0 text-sm text-emerald-700 print:text-xs">
									{job.challenges_and_achievements.map((achievement) => (
										<li class="print:leading-tight">{achievement}</li>
									))}
								</ul>
							</div>
						)}
						<div class="flex flex-wrap gap-1 mt-1.5 print:mt-1">
							{job.frameworks_and_tools.slice(0, 10).map((tool) => (
								<span class="text-[10px] bg-amber-50 text-amber-700 px-1.5 py-0.5 rounded border border-amber-200 print:text-[8px] print:px-1 print:py-0 print:bg-transparent">{tool}</span>
							))}
							{job.frameworks_and_tools.length > 10 && (
								<span class="text-[10px] text-stone-400 print:text-[8px]">+{job.frameworks_and_tools.length - 10} more</span>
							)}
						</div>
					</div>
					</>
				))}
			</div>
		</section>

		<!-- Employment History & Education - Side by Side -->
		<section class="print:mb-2">
			<div class="grid md:grid-cols-2 gap-6 print:gap-4">
				<div>
					<h2 class="text-sm font-bold text-stone-900 uppercase tracking-wider border-b border-stone-300 pb-1 mb-2">Employment History</h2>
					<div class="space-y-2 print:space-y-1">
						{employment_history.map((emp) => (
							<div class="flex items-start gap-2">
								<div class="w-1.5 h-1.5 rounded-full bg-amber-500 mt-1.5 shrink-0"></div>
								<div>
									<p class="font-medium text-stone-900 text-sm print:text-xs">{emp.company} <span class="text-stone-400 font-normal">({emp.employment_type})</span></p>
									<p class="text-xs text-stone-500">{emp.duration} — {emp.location}</p>
								</div>
							</div>
						))}
					</div>
				</div>
				<div>
					<h2 class="text-sm font-bold text-stone-900 uppercase tracking-wider border-b border-stone-300 pb-1 mb-2">Education</h2>
					{education.map((edu) => (
						<div>
							<h3 class="font-semibold text-stone-900 text-sm print:text-xs">{edu.degree} in {edu.major}</h3>
							<p class="text-xs text-amber-700">{edu.institution}, {edu.location} ({edu.graduation_year})</p>
						</div>
					))}
				</div>
			</div>
		</section>

	</div>

	<!-- Compact Resume (Tab 2) -->
	<div class="tab-content hidden bg-white rounded-xl border border-stone-200 p-6 md:p-10 print:border-0 print:shadow-none print:p-0" id="compact" data-tab-content="compact">

		<!-- Header / Personal Info -->
		<header class="text-center border-b border-stone-200 pb-3 mb-4 print:pb-2 print:mb-3">
			<h1 class="text-2xl md:text-3xl font-bold text-stone-900 tracking-wide mb-1 print:text-2xl">{personal_info.name}</h1>
			<div class="flex flex-wrap justify-center items-center gap-x-3 gap-y-1 text-sm text-stone-600 print:text-sm">
				<span>{personal_info.location}</span>
				<span class="text-stone-300">|</span>
				<span>{personal_info.phone}</span>
				<span class="text-stone-300">|</span>
				<a href={`mailto:${personal_info.email}`} class="text-amber-600 hover:text-amber-700">{personal_info.email}</a>
				<span class="text-stone-300">|</span>
				<a href={personal_info.links.linktree} class="text-amber-600 hover:text-amber-700">{personal_info.links.linktree.replace('https://', '')}</a>
			</div>
		</header>

		<!-- Professional Summary -->
		<section class="mb-4 print:mb-3">
			<h2 class="text-sm font-bold text-stone-900 uppercase tracking-wider border-b border-stone-300 pb-1 mb-2">Summary</h2>
			<p class="text-sm text-stone-600 print:text-xs leading-relaxed">
				Senior Software Developer with 15+ years of experience in full-stack development, cloud architecture, and data engineering.
				Expertise in Java, Python, Go, and modern cloud technologies (AWS, Kubernetes).
				Proven track record of improving system performance, leading migrations, and building scalable solutions.
			</p>
		</section>

		<!-- Skills Grid -->
		<section class="mb-4 print:mb-3">
			<h2 class="text-sm font-bold text-stone-900 uppercase tracking-wider border-b border-stone-300 pb-1 mb-2">Technical Skills</h2>
			<div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm print:text-xs">
				<div>
					<p class="font-semibold text-stone-700 mb-1">Languages</p>
					<p class="text-stone-600">Java, Python, Go, JavaScript, NodeJS</p>
				</div>
				<div>
					<p class="font-semibold text-stone-700 mb-1">Cloud & DevOps</p>
					<p class="text-stone-600">AWS, Terraform, GitLab CI, Docker</p>
				</div>
				<div>
					<p class="font-semibold text-stone-700 mb-1">Databases</p>
					<p class="text-stone-600">PostgreSQL, MySQL, DynamoDB, Snowflake</p>
				</div>
				<div>
					<p class="font-semibold text-stone-700 mb-1">Frameworks</p>
					<p class="text-stone-600">Spring Boot, Flask, GraphQL, Vue.js</p>
				</div>
			</div>
		</section>

		<!-- Certifications (Inline) -->
		<section class="mb-4 print:mb-3">
			<h2 class="text-sm font-bold text-stone-900 uppercase tracking-wider border-b border-stone-300 pb-1 mb-2">Certifications</h2>
			<p class="text-sm text-stone-600 print:text-xs">{certifications.join(' • ')}</p>
		</section>

		<!-- Compact Work Experience -->
		<section class="mb-4 print:mb-3">
			<h2 class="text-sm font-bold text-stone-900 uppercase tracking-wider border-b border-stone-300 pb-1 mb-3">Experience</h2>
			<div class="space-y-3 print:space-y-2">
				{work_experience.map((job) => (
					<div class="compact-job-entry">
						<div class="flex justify-between items-start gap-2">
							<span class="font-semibold text-stone-900 print:text-sm">{job.position}</span>
							<span class="text-sm text-stone-500 font-medium shrink-0 print:text-xs">{job.duration}</span>
						</div>
						<p class="text-amber-700 font-medium text-sm print:text-xs mb-1">{job.company} — {job.location}</p>
						<ul class="list-disc list-outside ml-5 space-y-0 text-sm text-stone-600 print:text-xs">
							{job.responsibilities.slice(0, 3).map((resp) => (
								<li class="print:leading-tight">{resp}</li>
							))}
						</ul>
						{job.challenges_and_achievements && job.challenges_and_achievements.length > 0 && (
							<p class="text-xs text-emerald-700 mt-1 print:text-[10px]">
								<span class="font-semibold">Key:</span> {job.challenges_and_achievements[0]}
							</p>
						)}
					</div>
				))}
			</div>
		</section>

		<!-- Education & Employment Side by Side -->
		<section>
			<div class="grid md:grid-cols-2 gap-4 print:gap-3">
				<div>
					<h2 class="text-sm font-bold text-stone-900 uppercase tracking-wider border-b border-stone-300 pb-1 mb-2">Employment</h2>
					<div class="text-sm text-stone-600 print:text-xs space-y-1">
						{employment_history.map((emp) => (
							<p><span class="font-medium text-stone-900">{emp.company}</span> ({emp.employment_type}) — {emp.duration}</p>
						))}
					</div>
				</div>
				<div>
					<h2 class="text-sm font-bold text-stone-900 uppercase tracking-wider border-b border-stone-300 pb-1 mb-2">Education</h2>
					{education.map((edu) => (
						<div class="text-sm print:text-xs">
							<p class="font-medium text-stone-900">{edu.degree} in {edu.major}</p>
							<p class="text-stone-500">{edu.institution}, {edu.graduation_year}</p>
						</div>
					))}
				</div>
			</div>
		</section>

	</div>
</Layout>

<script>
	// Tab switching functionality
	document.addEventListener('DOMContentLoaded', () => {
		const tabButtons = document.querySelectorAll('.tab-btn');
		const tabContents = document.querySelectorAll('.tab-content');

		tabButtons.forEach(button => {
			button.addEventListener('click', () => {
				const targetTab = button.getAttribute('data-tab');

				// Update button styles
				tabButtons.forEach(btn => {
					if (btn.getAttribute('data-tab') === targetTab) {
						btn.classList.remove('text-stone-500', 'hover:text-stone-700', 'border-transparent', 'hover:border-stone-300');
						btn.classList.add('text-amber-700', 'border-amber-600', 'bg-amber-50');
					} else {
						btn.classList.remove('text-amber-700', 'border-amber-600', 'bg-amber-50');
						btn.classList.add('text-stone-500', 'hover:text-stone-700', 'border-transparent', 'hover:border-stone-300');
					}
				});

				// Show/hide tab content
				tabContents.forEach(content => {
					if (content.getAttribute('data-tab-content') === targetTab) {
						content.classList.remove('hidden');
					} else {
						content.classList.add('hidden');
					}
				});
			});
		});
	});
</script>

<script type="module">
	import { Document, Packer, Paragraph, TextRun, HeadingLevel, AlignmentType, BorderStyle } from 'https://esm.sh/docx@8.5.0';

	const resumeData = JSON.parse(document.getElementById('resume-data').textContent);

	document.getElementById('download-docx').addEventListener('click', async () => {
		const { personal_info, certifications, opensource_projects, work_experience, education, employment_history } = resumeData;

		const doc = new Document({
			sections: [{
				properties: {},
				children: [
					// Name
					new Paragraph({
						children: [new TextRun({ text: personal_info.name, bold: true, size: 32 })],
						alignment: AlignmentType.CENTER,
						spacing: { after: 100 }
					}),
					// Contact Info
					new Paragraph({
						children: [
							new TextRun({ text: `${personal_info.location} | ${personal_info.phone} | ${personal_info.email} | ${personal_info.links.linktree}`, size: 20 })
						],
						alignment: AlignmentType.CENTER,
						spacing: { after: 300 }
					}),
					// Certifications
					new Paragraph({
						children: [new TextRun({ text: "CERTIFICATIONS", bold: true, size: 22 })],
						spacing: { before: 200, after: 100 },
						border: { bottom: { style: BorderStyle.SINGLE, size: 1 } }
					}),
					new Paragraph({
						children: [new TextRun({ text: certifications.join(" • "), size: 20 })],
						spacing: { after: 200 }
					}),
					// Open Source
					new Paragraph({
						children: [new TextRun({ text: "OPEN SOURCE", bold: true, size: 22 })],
						spacing: { before: 200, after: 100 },
						border: { bottom: { style: BorderStyle.SINGLE, size: 1 } }
					}),
					new Paragraph({
						children: [new TextRun({ text: opensource_projects.join(" • "), size: 20 })],
						spacing: { after: 200 }
					}),
					// Professional Experience
					new Paragraph({
						children: [new TextRun({ text: "PROFESSIONAL EXPERIENCE", bold: true, size: 22 })],
						spacing: { before: 200, after: 100 },
						border: { bottom: { style: BorderStyle.SINGLE, size: 1 } }
					}),
					// Work experience entries
					...work_experience.flatMap(job => [
						new Paragraph({
							children: [
								new TextRun({ text: job.position, bold: true, size: 22 }),
							],
							spacing: { before: 200 }
						}),
						new Paragraph({
							children: [
								new TextRun({ text: `${job.company} — ${job.location}`, italics: true, size: 20 }),
								new TextRun({ text: `    ${job.duration}`, size: 20 })
							],
							spacing: { after: 100 }
						}),
						...job.responsibilities.map(resp =>
							new Paragraph({
								children: [new TextRun({ text: resp, size: 20 })],
								bullet: { level: 0 },
								spacing: { after: 50 }
							})
						),
						...(job.challenges_and_achievements ? [
							new Paragraph({
								children: [new TextRun({ text: "Key Achievements:", bold: true, size: 20, color: "2E7D32" })],
								spacing: { before: 100 }
							}),
							...job.challenges_and_achievements.map(achievement =>
								new Paragraph({
									children: [new TextRun({ text: achievement, size: 20, color: "2E7D32" })],
									bullet: { level: 0 },
									spacing: { after: 50 }
								})
							)
						] : []),
						new Paragraph({
							children: [new TextRun({ text: `Tools: ${job.frameworks_and_tools.join(", ")}`, size: 18, italics: true })],
							spacing: { after: 150 }
						})
					]),
					// Employment History
					new Paragraph({
						children: [new TextRun({ text: "EMPLOYMENT HISTORY", bold: true, size: 22 })],
						spacing: { before: 300, after: 100 },
						border: { bottom: { style: BorderStyle.SINGLE, size: 1 } }
					}),
					...employment_history.map(emp =>
						new Paragraph({
							children: [
								new TextRun({ text: `${emp.company} `, bold: true, size: 20 }),
								new TextRun({ text: `(${emp.employment_type}) — ${emp.duration} — ${emp.location}`, size: 20 })
							],
							spacing: { after: 50 }
						})
					),
					// Education
					new Paragraph({
						children: [new TextRun({ text: "EDUCATION", bold: true, size: 22 })],
						spacing: { before: 300, after: 100 },
						border: { bottom: { style: BorderStyle.SINGLE, size: 1 } }
					}),
					...education.map(edu =>
						new Paragraph({
							children: [
								new TextRun({ text: `${edu.degree} in ${edu.major}`, bold: true, size: 20 }),
								new TextRun({ text: ` — ${edu.institution}, ${edu.location} (${edu.graduation_year})`, size: 20 })
							]
						})
					)
				]
			}]
		});

		const blob = await Packer.toBlob(doc);

		// Download the file
		const url = URL.createObjectURL(blob);
		const a = document.createElement('a');
		a.href = url;
		a.download = 'Supratim_Samanta_Resume.docx';
		document.body.appendChild(a);
		a.click();
		document.body.removeChild(a);
		URL.revokeObjectURL(url);
	});
</script>

<style>
	@media print {
		@page {
			margin: 0.5in 0.75in;
			size: letter;
		}

		@page :first {
			margin-top: 0.5in;
		}

		body {
			print-color-adjust: exact;
			-webkit-print-color-adjust: exact;
			font-size: 12px;
			line-height: 1.5;
		}

		.tab-content {
			padding: 0 !important;
		}

		/* Hide ALL non-resume content */
		nav, footer, header.print\\:hidden, .print\\:hidden {
			display: none !important;
			visibility: hidden !important;
			height: 0 !important;
			overflow: hidden !important;
		}

		/* Hide site navigation and footer from Layout */
		body > div > nav,
		body > div > footer,
		body > div > div > nav,
		body > div > div > footer {
			display: none !important;
		}

		/* Reset container styles */
		#resume-content {
			padding: 0.5in !important;
			border: none !important;
			box-shadow: none !important;
			max-width: 100% !important;
		}

		/* Only keep individual job entries together, not entire sections */
		.job-entry {
			break-inside: avoid;
			page-break-inside: avoid;
		}

		/* Keep section headers with at least some content */
		h2 {
			break-after: avoid;
			page-break-after: avoid;
		}

		/* Tighter spacing for print */
		section {
			margin-bottom: 0.75rem !important;
		}

		/* Reduce list spacing */
		ul {
			margin-top: 0.25rem !important;
			margin-bottom: 0.25rem !important;
		}

		li {
			margin-bottom: 0.1rem !important;
		}

		/* Text sizing for print */
		.responsibilities {
			font-size: 11px;
		}

		.job-entry h3 {
			font-size: 13px;
		}
	}

	/* Screen-only utility for job entries */
	.job-entry,
	.compact-job-entry {
		break-inside: avoid;
	}

	/* Manual page break utility */
	.page-break {
		display: none;
	}

	@media print {
		.page-break {
			display: block;
			break-before: page;
			page-break-before: always;
		}

		.page-break + .job-entry {
			margin-top: 0.4in;
		}
	}
</style>
